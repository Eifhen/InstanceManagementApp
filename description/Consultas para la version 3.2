{"NombreConsulta":"Consultas para la version 3.2","Descripcion":"","Fecha":"2019-11-22","Consulta":"ALTER TABLE `bash` \r\nADD COLUMN `factura_contado` DECIMAL(8,2) NULL DEFAULT '0.00' AFTER `impuesto_ingresos`,\r\nADD COLUMN `factura_credito` DECIMAL(8,2) NULL DEFAULT '0.00' AFTER `factura_contado`,\r\nADD COLUMN `factura_chequeTran` DECIMAL(8,2) NULL DEFAULT '0.00' AFTER `factura_credito`;\r\n\r\nALTER TABLE `bash` \r\nADD COLUMN `impuesto_ingresos` DECIMAL(8,2) NULL DEFAULT 0.00 AFTER `saldado`;\r\n\r\nDELIMITER $$\r\n\r\nCREATE FUNCTION `Get_TotalFactura` (id_sucursal int, tpago varchar(25))\r\nRETURNS decimal(8,2)\r\nBEGIN\r\ndeclare _tfacturacontado decimal(8,2);\r\nset _tfacturacontado=(Select  sum(Total_Factura)\r\n FROM \r\n facturas\r\n WHERE \r\n idsucursal= id_sucursal and Tipo_pago=tpago and Estado<>'Anulada' and\r\n timestamp(fecha_registro) <= timestamp(curdate()+1) AND timestamp(fecha_registro)>=timestamp(curdate()));\r\nRETURN _tfacturacontado;\r\nEND$$\r\n\r\nDELIMITER ;\r\n\r\n\r\nDROP procedure IF EXISTS `Cerrarbash`;\r\n\r\nDELIMITER $$\r\n\r\nCREATE  PROCEDURE `Cerrarbash`(id_bash int,fecha datetime,ingresos decimal(8,2),\r\ngastos decimal(8,2),impuestos decimal(8,2),cedula varchar(45), id_sucursal int,_fondos decimal(8,2)\r\n,_saldar decimal(8,2),_ingresos_impuesto decimal(8,2))\r\nBEGIN\r\n\r\n\/*Insertar el total de facturas por tipo de pagos *\/\r\ndeclare _tfacturacontado decimal (8,2);\r\ndeclare _tfacturacredito decimal (8,2);\r\ndeclare _tfacturachequeTra decimal (8,2);\r\n\r\nset _tfacturacontado=(select Get_TotalFactura(id_sucursal,'Al contado')as TotalContado);\r\nset _tfacturacredito=(select Get_TotalFactura(id_sucursal,'Cr\u00e9dito')as TotalContado);\r\nset _tfacturachequeTra=(select Get_TotalFactura(id_sucursal,'Cheque o transf')as TotalContado);\r\n\r\n\/*Insertando al bash los datos*\/\r\ninsert into bash values(date_format(fecha,'%Y%m%d'),\r\nfecha,ingresos,gastos,impuestos,cedula,id_sucursal,null,_fondos,_saldar,\r\n_ingresos_impuesto,_tfacturacontado,_tfacturacredito,_tfacturachequeTra);\r\n\r\n\r\nEND$$\r\n\r\nDELIMITER ;\r\n"}